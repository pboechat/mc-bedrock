services:
  bedrock:
    image: itzg/minecraft-bedrock-server:latest
    container_name: mc-bedrock
    restart: unless-stopped

    # Bedrock uses UDP 19132 by default
    ports:
      - "19132:19132/udp"

    environment:
      EULA: "TRUE"
      SERVER_NAME: "Kaaruna"
      GAMEMODE: "survival"
      DIFFICULTY: "normal"
      MAX_PLAYERS: "10"
      ONLINE_MODE: "true"
      ALLOW_CHEATS: "false"
      # optional:
      LEVEL_NAME: "world"

    volumes:
      - ./data:/data
    # Optional hardening (untested)
    # read_only: true
    # tmpfs:
    #   - /tmp
    # cap_drop:
    #   - ALL
    # security_opt:
    #   - no-new-privileges:true

  mapper:
    build: ./mapper
    container_name: mc-map
    restart: unless-stopped
    environment: {}
      # BEDROCK_WORLD_DIR: "/bedrock/worlds/world"  # Path to Bedrock world inside this container (via volume mount)
      # OUTPUT_PATH: "/webroot"  # Where to write the rendered map files
      # JAVA_WORLD_DIR: "/bedrock/worlds/world_java"  # Path to converted Java world
      # CONFIG_DIR: "/opt/bluemap/config"  # BlueMap configuration directory
      # BLUEMAP_RENDER_THREADS: "2"  # Number of threads for rendering (adjust based on CPU)
      # RENDER_INTERVAL: "600"  # How often to re-render the map (in seconds)
      # BLUEMAP_AMBIENT_LIGHT: "1.0"  # Adjust ambient light level in the map (0.0 to 1.0)
      # BLUEMAP_JAR: /opt/bluemap/BlueMap-cli.jar  # Path to BlueMap CLI jar (if not using built-in version)
    ports:
      - "8100:8100"
    volumes:
      # Mount Bedrock server data as read-only
      - ./data:/bedrock:ro
      # Use local mapper script directly (no rebuild needed for mapper.py edits)
      - ./mapper/mapper.py:/usr/local/bin/mapper.py:ro
      # Persistent map output
      - ./mapper-output:/webroot
      # Persistent BlueMap configuration
      - ./mapper-config:/opt/bluemap/config
